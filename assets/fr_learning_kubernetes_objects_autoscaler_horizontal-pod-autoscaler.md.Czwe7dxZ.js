import{_ as i,D as a,c as t,j as s,I as n,a as l,a1 as o,o as r,ai as p,aj as h}from"./chunks/framework.CgL1aY5S.js";const C=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[],"relativePath":"fr/learning/kubernetes/objects/autoscaler/horizontal-pod-autoscaler.md","filePath":"fr/learning/kubernetes/objects/autoscaler/horizontal-pod-autoscaler.md"}'),d={name:"fr/learning/kubernetes/objects/autoscaler/horizontal-pod-autoscaler.md"},c={id:"",tabindex:"-1"},u=s("a",{class:"header-anchor",href:"#","aria-label":`Permalink to "<KubernetesIcon icon='/clusters/learning/kubernetes/icons/hpa.svg' label='Horizontal Pod Autoscaler' :width='45' :height='45' />"`},"​",-1),k=o('<p>L&#39;<a href="https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale/" target="_blank" rel="noreferrer">Horizontal Pod Autoscaler (HPA)</a> ajuste automatiquement le nombre de Pods dans un contrôleur de réplication, un déploiement, un ReplicaSet ou un StatefulSet en fonction de l&#39;utilisation des ressources (<code>cpu</code>, <code>memory</code> ou métriques personnalisées). Cela permet de réaliser une mise à l&#39;échelle horizontale en <strong>ajoutant ou supprimant des instances de Pods</strong> pour répondre à la demande.</p><img src="'+p+'" alt="hpa" style="width:60%;display:block;margin:0 auto;"><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p>HPA ne fonctionne pas avec les <code>DaemonSets</code>.</p></div><div class="info custom-block"><p class="custom-block-title">INFO</p><p>Par défaut, un HPA vérifie les métriques toutes les 15 secondes.</p></div><h2 id="fonctionnalites" tabindex="-1">Fonctionnalités <a class="header-anchor" href="#fonctionnalites" aria-label="Permalink to &quot;Fonctionnalités&quot;">​</a></h2><ul><li><strong>Ajustement Automatique</strong> : Une fois configuré avec un <strong>nombre <code>MIN</code> et <code>MAX</code> de répliques</strong>, le HPA surveille et ajuste automatiquement les répliques en fonction de la charge</li><li><strong>Flexibilité avec les Métriques</strong> : Peut utiliser des <strong>métriques personnalisées (l&#39;heure de la journée, les week-ends ou les heures creuses)</strong> pour adapter l&#39;échelle en fonction des besoins spécifiques de l&#39;application</li></ul><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p>Si le cluster manque de capacité, le HPA ne pourra pas scaler tant que de nouveaux nœuds ne seront pas ajoutés</p></div><h2 id="fonctionnement" tabindex="-1">Fonctionnement <a class="header-anchor" href="#fonctionnement" aria-label="Permalink to &quot;Fonctionnement&quot;">​</a></h2><p>Le HPA fonctionne selon une boucle continue (vérifier, mettre à jour, vérifier à nouveau)</p><p><img src="'+h+`" alt="hpa-operation"></p><ol><li><strong>Définition du HPA</strong>: Un fichier YAML spécifie le HPA</li><li><strong>Création</strong>: <strong>kubectl</strong> traduit le fichier YAML en requêtes HTTP REST et les envoie au <code>kube-apiserver</code></li><li><strong>Traitement par le <code>kube-apiserver</code></strong>: Le <code>kube-apiserver</code> valide et stocke la configuration dans <code>etcd</code>, puis la transmet aux composants concernés</li><li><strong>Surveillance des Métriques</strong> : Le HPA collecte régulièrement les métriques d&#39;utilisation des ressources à partir du Metrics Server</li><li><strong>Calcul de la Mise à l&#39;Échelle</strong> : En fonction des métriques collectées, le HPA calcule le nombre optimal de répliques nécessaires</li><li><strong>Ajustement des Répliques</strong> : Le HPA décide d&#39;ajouter ou de supprimer des répliques en fonction du calcul précédent</li><li><strong>Mise à Jour des Répliques</strong> : Les répliques sont mises à jour selon les décisions prises, assurant ainsi une adaptation dynamique à la charge.</li></ol><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p>Une mauvaise configuration des limites de CPU et de mémoire des Pods peut entraîner des arrêts fréquents ou un gaspillage de ressources</p></div><h2 id="configuration" tabindex="-1">Configuration <a class="header-anchor" href="#configuration" aria-label="Permalink to &quot;Configuration&quot;">​</a></h2><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">apiVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">autoscaling/v1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">kind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">HorizontalPodAutoscaler</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">metadata</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;"> name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">hpa-phpbb</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;"> namespace</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">forum</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">spec</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;"> scaleTargetRef</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">   apiVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">apps/v1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">   kind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Deployment</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">   name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">phpbb</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;"> minReplicas</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;"> maxReplicas</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">15</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;"> targetCPUUtilizationPercentage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">50</span></span></code></pre></div><table><thead><tr><th>Paramètre</th><th>Description</th></tr></thead><tbody><tr><td><code>minReplicas</code></td><td>Nombre minimum de répliques de Pod</td></tr><tr><td><code>maxReplicas</code></td><td>Nombre maximum de répliques de Pod</td></tr><tr><td><code>targetCPUUtilizationPercentage</code></td><td>Pourcentage d&#39;utilisation du CPU au-delà duquel le HPA doit augmenter le nombre de répliques jusqu&#39;au maximum défini</td></tr></tbody></table><h2 id="test" tabindex="-1">Test <a class="header-anchor" href="#test" aria-label="Permalink to &quot;Test&quot;">​</a></h2><p>Pour tester le HPA, il faut <strong>simuler une augmentation de la charge</strong> et observer la réaction du système en vérifiant les répliques</p><ol><li>Script pour simuler une augmentation de la charge</li></ol><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -L</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://goo.gl/S1Dc3R</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> bash</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -s</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10000</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;http://&lt;cluster_IP&gt;:&lt;port&gt;&quot;</span></span></code></pre></div><ol start="2"><li>Vérification de l&#39;ajustement du nombre de répliques en réponse à la charge accrue</li></ol><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">watch</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> all</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -n</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">namespac</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span></code></pre></div>`,21);function g(m,E,b,y,F,f){const e=a("KubernetesIcon");return r(),t("div",null,[s("h1",c,[n(e,{icon:"/clusters/learning/kubernetes/icons/hpa.svg",label:"Horizontal Pod Autoscaler",width:45,height:45}),l(),u]),k])}const A=i(d,[["render",g]]);export{C as __pageData,A as default};
