import{_ as i,D as a,c as t,j as s,I as n,a as l,a1 as o,o as r,ak as d,al as p}from"./chunks/framework.CgL1aY5S.js";const f=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[],"relativePath":"fr/learning/kubernetes/objects/autoscaler/vertical-pod-autoscaler.md","filePath":"fr/learning/kubernetes/objects/autoscaler/vertical-pod-autoscaler.md"}'),c={name:"fr/learning/kubernetes/objects/autoscaler/vertical-pod-autoscaler.md"},h={id:"",tabindex:"-1"},k=s("a",{class:"header-anchor",href:"#","aria-label":`Permalink to "<KubernetesIcon icon='/clusters/learning/kubernetes/icons/vpa.svg' label='Vertical Pod Autoscaler' :width='45' :height='45' />"`},"​",-1),u=o('<p>Le Kubernetes <a href="https://github.com/kubernetes/autoscaler/tree/master/vertical-pod-autoscaler" target="_blank" rel="noreferrer">Vertical Pod Autoscaler (VPA)</a> ajuste automatiquement les ressources (CPU et mémoire) allouées aux containers en fonction de leur utilisation. En analysant les données historiques, il <strong>augmente ou diminue les demandes de ressources et les limites</strong> pour optimiser la performance des applications.</p><img src="'+d+'" alt="vpa" style="width:60%;display:block;margin:0 auto;"><div class="danger custom-block"><p class="custom-block-title">⚠️ Ne pas utiliser VPA avec HPA</p><p>N&#39;utilisez pas le VPA avec le HPA qui évolue en fonction des mêmes métriques de ressources, car ils peuvent entrer en conflit en se basant sur les mêmes métriques (CPU, mémoire), entraînant des effets secondaires indésirables.</p></div><h2 id="composants" tabindex="-1">Composants <a class="header-anchor" href="#composants" aria-label="Permalink to &quot;Composants&quot;">​</a></h2><table><thead><tr><th>Composant</th><th>Description</th></tr></thead><tbody><tr><td><code>VPA Recommender</code></td><td>Surveille l&#39;utilisation des ressources, examine l&#39;historique et les spécifications de déploiement, puis propose des ajustements des ressources</td></tr><tr><td><code>VPA Updater</code></td><td>Expulse les Pods pour appliquer les nouvelles recommandations de ressources si le mode <code>updateMode</code> est défini sur <code>Auto</code></td></tr><tr><td><code>VPA Admission Controler</code></td><td>Modifie les demandes de ressources des nouveaux Pods avant leur création, en fonction des recommandations du <code>VPA Recommender</code></td></tr></tbody></table><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p>Le VPA peut recommander plus de ressources que disponibles, empêchant le Pod de démarrer. Définir un <code>LimitRange</code> peut prévenir ce problème en limitant les ressources demandées.</p></div><h2 id="fonctionnement" tabindex="-1">Fonctionnement <a class="header-anchor" href="#fonctionnement" aria-label="Permalink to &quot;Fonctionnement&quot;">​</a></h2><p><img src="'+p+`" alt="vpa-operation"></p><ol><li><strong>Définition du VPA</strong>: Un fichier YAML spécifie le VPA</li><li><strong>Création</strong>: <strong>kubectl</strong> traduit le fichier YAML en requêtes HTTP REST et les envoie au <code>kube-apiserver</code></li><li><strong>Traitement par le <code>kube-apiserver</code></strong>: Le <code>kube-apiserver</code> valide et stocke la configuration dans <code>etcd</code>, puis la transmet aux composants concernés</li><li><strong>Analyse des ressources</strong>: Le <code>VPA Recommender</code> lit la configuration VPA et les métriques d&#39;utilisation des ressources</li><li><strong>Recommandations</strong>: Le <code>VPA Recommender</code> fournit des recommandations de ressources pour les Pods</li><li><strong>Mise à jour</strong>: Le <code>VPA Updater</code> lit les recommandations et lance la résiliation des Pods nécessitant de nouvelles ressources</li><li><strong>Recréation des Pods</strong>: Le déploiement recrée les Pods avec les nouvelles ressources</li><li><strong>Injection des recommandations</strong>: Le <code>VPA Admission Controller</code> injecte les recommandations de ressources dans les nouveaux Pods lors de leur création</li><li><strong>Exécution des Pods</strong>: Les nouveaux Pods s&#39;exécutent avec les ressources mises à jour</li></ol><h2 id="installation" tabindex="-1">Installation <a class="header-anchor" href="#installation" aria-label="Permalink to &quot;Installation&quot;">​</a></h2><ol><li>Installer avec Helm :</li></ol><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">helm repo add cowboysysop https://cowboysysop.github.io/charts/</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">helm install vpa cowboysysop/vertical-pod-autoscaler --namespace kube-system</span></span></code></pre></div><ol start="2"><li>Vérifier les pods déployés :</li></ol><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">kubectl get pod -n kube-system</span></span></code></pre></div><h2 id="configuration" tabindex="-1">Configuration <a class="header-anchor" href="#configuration" aria-label="Permalink to &quot;Configuration&quot;">​</a></h2><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">apiVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">autoscaling.k8s.io/v1beta2</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">kind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">VerticalPodAutoscaler</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">metadata</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">vpa</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  namespace</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">vpa</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">spec</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  targetRef</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    apiVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;apps/v1&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    kind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Deployment</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">nginx</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  updatePolicy</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    updateMode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Auto&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  resourcePolicy</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    containerPolicies</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">containerName</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;nginx&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      minAllowed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        cpu</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;250m&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        memory</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;100Mi&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      maxAllowed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        cpu</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;500m&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        memory</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;600Mi&quot;</span></span></code></pre></div><h3 id="exclure-la-mise-a-l-echelle-d-un-container" tabindex="-1">Exclure la mise à l&#39;échelle d&#39;un container <a class="header-anchor" href="#exclure-la-mise-a-l-echelle-d-un-container" aria-label="Permalink to &quot;Exclure la mise à l&#39;échelle d&#39;un container&quot;">​</a></h3><p>Utilisez le paramètre <code>mode</code> avec la valeur <code>Off</code></p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">resourcePolicy</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  containerPolicies</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">containerName</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">monitoring</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    mode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Off&quot;</span></span></code></pre></div><h3 id="modes-d-update" tabindex="-1">Modes d&#39;Update <a class="header-anchor" href="#modes-d-update" aria-label="Permalink to &quot;Modes d&#39;Update&quot;">​</a></h3><table><thead><tr><th>Mode</th><th>Description</th></tr></thead><tbody><tr><td><code>Off</code></td><td>Le VPA fournit des recommandations sans modifier automatiquement les ressources</td></tr><tr><td><code>Initial</code></td><td>Le VPA attribue les ressources à la création du Pod sans les modifier ensuite</td></tr><tr><td><code>Recreate</code></td><td>Le VPA met à jour les ressources des Pods en les supprimant et les recréant</td></tr><tr><td><code>Auto</code></td><td>Le VPA recrée les Pods en fonction des recommandations</td></tr></tbody></table>`,21);function E(m,g,y,b,v,A){const e=a("KubernetesIcon");return r(),t("div",null,[s("h1",h,[n(e,{icon:"/clusters/learning/kubernetes/icons/vpa.svg",label:"Vertical Pod Autoscaler",width:45,height:45}),l(),k]),u])}const F=i(c,[["render",E]]);export{f as __pageData,F as default};
